<!--
  Media Vault Prototype
  Round: zeta-2
  Concept: Inbox Reading Pane ‚Äî jobs as messages from creators, selected job expands in reading pane
  Special Feature: Adaptive Information Density ‚Äî the job list automatically adjusts card height and visible metadata based on the total job count; fewer jobs = spacious editorial cards with preview data; many jobs = ultra-compact single-line rows; threshold is live, updates as jobs are added/removed
  Score Target: 90+
-->
<!-- SPECIAL FEATURE: Adaptive Information Density ‚Äî card layout recalculates density tier (spacious/standard/compact) based on live job count, animating smoothly between display modes with no user action required -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Media Vault ‚Äî Inbox</title>
<style>
  /* ============================================================
     DESIGN TOKENS
  ============================================================ */
  :root {
    --radius-xs: 4px;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;

    --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.35), 0 2px 6px rgba(0,0,0,0.2);
    --shadow-lg: 0 8px 24px rgba(0,0,0,0.4), 0 4px 12px rgba(0,0,0,0.25);
    --shadow-xl: 0 20px 48px rgba(0,0,0,0.5), 0 8px 24px rgba(0,0,0,0.3);

    /* Multi-layer glass tiers */
    --glass-t1-bg: rgba(255,255,255,0.07);
    --glass-t1-blur: blur(4px) saturate(160%);
    --glass-t2-bg: rgba(255,255,255,0.04);
    --glass-t2-blur: blur(12px) saturate(140%);
    --glass-t3-bg: rgba(255,255,255,0.02);
    --glass-t3-blur: blur(20px) saturate(120%);

    /* Asymmetric borders */
    --gb-top: rgba(255,255,255,0.12);
    --gb-left: rgba(255,255,255,0.08);
    --gb-right: rgba(0,0,0,0.08);
    --gb-bottom: rgba(0,0,0,0.12);

    /* Colors */
    --bg: #07090f;
    --surface: #0d1220;
    --elevated: #111a2a;

    --ink: #dce8f5;
    --ink-muted: #8898b8;
    --ink-faint: #aabace;

    /* Status ‚Äî desaturated atmospheric palette */
    --s-complete: hsl(145, 45%, 52%);
    --s-failed: hsl(0, 48%, 52%);
    --s-running: hsl(210, 50%, 58%);
    --s-queued: hsl(30, 15%, 52%);
    --s-canceled: hsl(220, 20%, 45%);

    /* Accent */
    --accent: hsl(213, 65%, 62%);
    --accent-rgb: 82, 138, 220;
    --accent-dim: hsl(213, 45%, 38%);

    /* Springs */
    --spring-enter: cubic-bezier(0.34, 1.56, 0.64, 1);
    --spring-exit: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --spring-snap: cubic-bezier(0.68, -0.55, 0.265, 1.55);

    /* Type scale */
    --t-display: clamp(3rem, 5vw, 5rem);
    --t-heading: clamp(1.2rem, 2vw, 1.45rem);
    --t-sub: 0.9375rem;
    --t-body: 0.84375rem;
    --t-caption: 0.71875rem;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--ink);
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    overflow: hidden;
  }

  .numeric, .count, .timestamp, [data-metric] {
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  /* Background ‚Äî subtle depth, no orbs */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 90% 50% at 20% 15%, rgba(82,138,220,0.05) 0%, transparent 55%),
      radial-gradient(ellipse 60% 60% at 80% 85%, rgba(100,60,200,0.03) 0%, transparent 50%),
      linear-gradient(175deg, #07090f 0%, #0a0e1a 60%, #050708 100%);
    pointer-events: none;
    z-index: 0;
  }

  /* ============================================================
     APP SHELL ‚Äî Inbox layout: narrow-left | list | reading-pane
  ============================================================ */
  #app {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 220px 320px 1fr;
    grid-template-rows: 100vh;
    height: 100vh;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  #app.ready { opacity: 1; }

  /* ============================================================
     ENTRANCE CHOREOGRAPHY
  ============================================================ */
  .chrome-anim {
    opacity: 0;
    animation: colFade 0.45s var(--spring-exit) 0.08s forwards;
  }
  .list-anim {
    opacity: 0;
    animation: colFade 0.5s var(--spring-exit) 0.18s forwards;
  }
  .pane-anim {
    opacity: 0;
    animation: colFade 0.45s var(--spring-exit) 0.32s forwards;
  }
  .intake-anim {
    opacity: 0;
    animation: colFade 0.4s var(--spring-exit) 0.48s forwards;
  }

  @keyframes colFade {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ============================================================
     LEFT NAV / CHROME
  ============================================================ */
  #nav {
    backdrop-filter: var(--glass-t3-blur);
    background: var(--glass-t3-bg);
    border-right: 1px solid rgba(255,255,255,0.04);
    display: flex;
    flex-direction: column;
    padding: 0;
    position: relative;
    overflow: hidden;
  }

  #nav::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  .nav-header {
    padding: 22px 18px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
  }

  .logo {
    font-size: var(--t-heading);
    font-weight: 700;
    letter-spacing: -0.025em;
    color: var(--ink);
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    gap: 9px;
  }

  .logo-mark {
    width: 30px;
    height: 30px;
    background: linear-gradient(140deg, hsl(213,65%,56%) 0%, hsl(240,55%,56%) 100%);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 15px;
    box-shadow: var(--shadow-sm);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
  }

  .logo-mark::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 30% 20%, rgba(255,255,255,0.3) 0%, transparent 60%);
    pointer-events: none;
  }

  /* Hero metric */
  .hero-section {
    padding: 18px 18px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }

  .hero-number {
    font-size: var(--t-display);
    font-weight: 800;
    letter-spacing: -0.04em;
    line-height: 1;
    color: var(--ink);
    text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  .hero-label {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* NAV items ‚Äî section selector */
  .nav-section { padding: 10px 10px; flex-shrink: 0; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 9px;
    padding: 9px 10px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: var(--t-body);
    font-weight: 400;
    color: var(--ink-muted);
    transition: background 0.15s ease, color 0.15s ease;
    user-select: none;
  }

  .nav-item:hover { background: rgba(255,255,255,0.04); color: var(--ink); }
  .nav-item.active {
    background: rgba(82,138,220,0.12);
    color: var(--accent);
    font-weight: 600;
  }

  .nav-icon { font-size: 14px; flex-shrink: 0; opacity: 0.8; }

  .nav-badge {
    margin-left: auto;
    font-size: var(--t-caption);
    background: rgba(255,255,255,0.07);
    color: var(--ink-muted);
    padding: 1px 7px;
    border-radius: var(--radius-xs);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  .nav-badge.running-badge { background: rgba(82,138,220,0.15); color: var(--s-running); }

  /* Settings section in nav */
  .nav-settings-section {
    padding: 10px 10px;
    border-top: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
  }

  .settings-label {
    font-size: var(--t-caption);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--ink-muted);
    padding: 0 10px;
    margin-bottom: 8px;
    font-weight: 400;
  }

  .platform-toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 7px 10px;
    border-radius: var(--radius-sm);
    margin-bottom: 4px;
    cursor: pointer;
    transition: background 0.15s ease;
  }

  .platform-toggle-row:hover { background: rgba(255,255,255,0.04); }

  .platform-toggle-name {
    font-size: var(--t-body);
    color: var(--ink-muted);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .platform-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* Unified toggle component */
  .toggle {
    width: 32px;
    height: 18px;
    border-radius: 999px;
    background: rgba(255,255,255,0.1);
    position: relative;
    cursor: pointer;
    border: none;
    outline: none;
    flex-shrink: 0;
    transition: background 0.2s var(--spring-snap);
  }
  .toggle.on { background: var(--s-running); }
  .toggle::after {
    content: '';
    position: absolute;
    top: 2px; left: 2px;
    width: 14px; height: 14px;
    background: white;
    border-radius: 50%;
    transition: transform 0.2s var(--spring-snap);
    box-shadow: var(--shadow-sm);
  }
  .toggle.on::after { transform: translateX(14px); }

  /* Mini stats */
  .mini-stats {
    padding: 10px 10px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
    border-top: 1px solid rgba(255,255,255,0.04);
  }

  .mini-stat {
    background: var(--glass-t1-bg);
    backdrop-filter: var(--glass-t1-blur);
    border-top: 1px solid var(--gb-top);
    border-left: 1px solid var(--gb-left);
    border-right: 1px solid var(--gb-right);
    border-bottom: 1px solid var(--gb-bottom);
    border-radius: var(--radius-sm);
    padding: 8px 10px;
    position: relative;
    overflow: hidden;
  }

  .mini-stat::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  .mini-stat-val {
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--ink);
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  .mini-stat-lbl {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    margin-top: 1px;
  }

  .nav-spacer { flex: 1; }

  /* Worker status */
  .worker-status {
    padding: 12px 18px;
    border-top: 1px solid rgba(255,255,255,0.04);
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: var(--t-caption);
    color: var(--ink-muted);
  }

  .worker-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--s-complete);
    flex-shrink: 0;
  }

  .worker-dot.active { animation: workerPulse 1.5s ease-in-out infinite; }

  @keyframes workerPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  /* ============================================================
     JOB LIST COLUMN
  ============================================================ */
  #job-list-col {
    display: flex;
    flex-direction: column;
    border-right: 1px solid rgba(255,255,255,0.04);
    background: var(--glass-t3-bg);
    backdrop-filter: var(--glass-t3-blur);
    overflow: hidden;
    position: relative;
  }

  #job-list-col::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 5%, rgba(255,255,255,0.03) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .list-col-header {
    padding: 22px 16px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
    position: relative;
    z-index: 1;
  }

  .list-col-title {
    font-size: var(--t-heading);
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--ink);
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    margin-bottom: 6px;
  }

  /* Density indicator ‚Äî the adaptive feature hint */
  .density-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: var(--t-caption);
    color: var(--ink-muted);
    background: rgba(255,255,255,0.04);
    padding: 2px 8px;
    border-radius: var(--radius-xs);
    transition: opacity 0.3s ease;
    font-weight: 400;
  }

  .density-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0.7;
  }

  #job-list-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 6px 8px;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.06) transparent;
    position: relative;
    z-index: 1;
  }

  #job-list-scroll::-webkit-scrollbar { width: 3px; }
  #job-list-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 2px; }

  /* ============================================================
     ADAPTIVE JOB CARDS ‚Äî THE SPECIAL FEATURE
     density-spacious: 4 or fewer jobs
     density-standard: 5‚Äì9 jobs
     density-compact: 10+ jobs
  ============================================================ */
  .job-row {
    display: flex;
    align-items: center;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition:
      background 0.15s ease,
      padding 0.4s var(--spring-exit),
      border-radius 0.3s ease;
    margin-bottom: 3px;
    position: relative;
    overflow: hidden;
    user-select: none;
    border-top: 1px solid rgba(255,255,255,0.04);
    border-left: 1px solid rgba(255,255,255,0.03);
    border-right: 1px solid rgba(0,0,0,0.04);
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }

  .job-row::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.03) 0%, transparent 60%);
    pointer-events: none;
  }

  .job-row:hover { background: rgba(255,255,255,0.04); }
  .job-row.selected {
    background: rgba(82,138,220,0.1);
    border-top-color: rgba(82,138,220,0.2);
    border-left-color: rgba(82,138,220,0.15);
  }

  /* Status stripe ‚Äî NOT a left vertical bar. A small inline indicator */
  .row-status-icon {
    width: 22px;
    height: 22px;
    border-radius: var(--radius-xs);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    flex-shrink: 0;
    margin-right: 10px;
    transition: width 0.4s var(--spring-exit), height 0.4s var(--spring-exit);
  }

  .row-status-icon.s-completed { background: rgba(80,175,120,0.15); color: var(--s-complete); }
  .row-status-icon.s-running { background: rgba(82,138,220,0.15); color: var(--s-running); }
  .row-status-icon.s-failed { background: rgba(200,80,80,0.15); color: var(--s-failed); }
  .row-status-icon.s-queued { background: rgba(140,120,90,0.12); color: var(--s-queued); }
  .row-status-icon.s-canceled { background: rgba(80,90,130,0.15); color: var(--s-canceled); }

  /* Pulse ‚Äî only ONE running job gets this */
  .row-status-icon.single-pulse {
    animation: rowPulse 1.5s ease-in-out infinite;
  }
  @keyframes rowPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.45; }
  }

  .row-body { flex: 1; min-width: 0; }

  .row-creator {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    font-weight: 600;
    margin-bottom: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: font-size 0.4s ease, margin-bottom 0.4s ease;
  }

  .row-title {
    font-size: var(--t-body);
    color: var(--ink);
    font-weight: 400;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: font-size 0.4s ease;
  }

  .row-meta {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    margin-top: 3px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-height: 20px;
    transition: max-height 0.4s ease, opacity 0.3s ease, margin-top 0.4s ease;
  }

  .row-time {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    flex-shrink: 0;
    margin-left: 8px;
    opacity: 0.7;
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  /* Density modes */
  #job-list-scroll.density-compact .job-row { padding: 6px 10px; margin-bottom: 1px; }
  #job-list-scroll.density-compact .row-creator { display: none; }
  #job-list-scroll.density-compact .row-meta { max-height: 0; opacity: 0; overflow: hidden; margin-top: 0; }
  #job-list-scroll.density-compact .row-status-icon { width: 18px; height: 18px; font-size: 8px; }

  #job-list-scroll.density-spacious .job-row { padding: 14px 14px; margin-bottom: 5px; }
  #job-list-scroll.density-spacious .row-creator { font-size: var(--t-body); margin-bottom: 4px; }
  #job-list-scroll.density-spacious .row-title { font-size: var(--t-sub); }
  #job-list-scroll.density-spacious .row-meta { max-height: 40px; }

  /* Job entrance animation */
  .job-row-enter {
    animation: rowEnter 0.35s var(--spring-enter) both;
  }
  @keyframes rowEnter {
    from { opacity: 0; transform: translateX(-8px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  /* ============================================================
     READING PANE
  ============================================================ */
  #reading-pane {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  /* Sub-layout: top = intake + detail, bottom = activity */
  #pane-upper {
    flex: 1;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.06) transparent;
    display: flex;
    flex-direction: column;
  }

  #pane-upper::-webkit-scrollbar { width: 3px; }
  #pane-upper::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 2px; }

  /* ============================================================
     INTAKE ‚Äî HERO ZONE
  ============================================================ */
  #intake-zone {
    padding: 28px 28px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
    background: var(--glass-t3-bg);
    backdrop-filter: var(--glass-t3-blur);
    position: relative;
  }

  #intake-zone::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  .intake-eyebrow {
    font-size: var(--t-caption);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink-muted);
    margin-bottom: 12px;
    font-weight: 400;
    position: relative;
    z-index: 1;
  }

  .intake-form-row {
    display: flex;
    gap: 0;
    align-items: stretch;
    position: relative;
    z-index: 1;
  }

  .intake-shell {
    flex: 1;
    display: flex;
    align-items: center;
    background: var(--glass-t1-bg);
    backdrop-filter: var(--glass-t1-blur);
    border-top: 1px solid var(--gb-top);
    border-left: 1px solid var(--gb-left);
    border-right: 1px solid rgba(0,0,0,0.04);
    border-bottom: 1px solid var(--gb-bottom);
    border-radius: var(--radius-xl) 0 0 var(--radius-xl);
    padding: 4px 14px 4px 18px;
    transition: box-shadow 0.22s ease, transform 0.14s ease;
    animation: intakeBreathe 4.5s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }

  .intake-shell::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.06) 0%, transparent 55%);
    pointer-events: none;
  }

  @keyframes intakeBreathe {
    0%, 100% { box-shadow: 0 0 20px rgba(82,138,220,0.04); }
    50% { box-shadow: 0 0 32px rgba(82,138,220,0.09); }
  }

  .intake-shell:focus-within {
    animation: none;
    box-shadow:
      0 0 0 2px var(--accent),
      0 0 40px rgba(82,138,220,0.12),
      0 0 80px rgba(82,138,220,0.06);
  }

  .intake-icon-prefix {
    color: var(--ink-muted);
    font-size: 14px;
    flex-shrink: 0;
    margin-right: 10px;
    opacity: 0.7;
  }

  #url-input {
    flex: 1;
    background: none;
    border: none;
    outline: none;
    color: var(--ink);
    font-size: clamp(13px, 1.3vw, 15px);
    font-weight: 450;
    padding: 13px 0;
    caret-color: var(--accent);
  }

  #url-input::placeholder { color: var(--ink-muted); opacity: 0.65; }

  /* Platform chip inside input */
  .p-chip {
    font-size: var(--t-caption);
    font-weight: 600;
    padding: 3px 9px;
    border-radius: var(--radius-xs);
    transform: scale(0.7);
    opacity: 0;
    transition: transform 0.25s var(--spring-enter), opacity 0.2s ease;
    flex-shrink: 0;
    margin-right: 4px;
  }
  .p-chip.show { transform: scale(1); opacity: 1; }
  .p-chip.x-chip { background: rgba(255,255,255,0.07); color: #b4c8e0; border: 1px solid rgba(255,255,255,0.1); }
  .p-chip.tt-chip { background: rgba(255,90,120,0.1); color: #e0a8b8; border: 1px solid rgba(255,90,120,0.12); }

  .intake-submit {
    padding: 0 22px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
    font-size: var(--t-body);
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.2s ease;
    box-shadow: var(--shadow-md);
    white-space: nowrap;
  }
  .intake-submit:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
  .intake-submit:active { transform: scale(0.97) translateY(0); box-shadow: var(--shadow-sm); }
  .intake-submit.ok { background: var(--s-complete); }

  /* ============================================================
     JOB DETAIL PANE
  ============================================================ */
  #detail-zone {
    flex: 1;
    padding: 24px 28px;
  }

  .detail-empty {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    opacity: 0.35;
    user-select: none;
  }

  .detail-empty-icon { font-size: 2rem; }
  .detail-empty-text {
    font-size: var(--t-body);
    color: var(--ink-muted);
    text-align: center;
  }

  /* Job detail card */
  .detail-card {
    background: var(--glass-t2-bg);
    backdrop-filter: var(--glass-t2-blur);
    border-top: 1px solid var(--gb-top);
    border-left: 1px solid var(--gb-left);
    border-right: 1px solid var(--gb-right);
    border-bottom: 1px solid var(--gb-bottom);
    border-radius: var(--radius-lg);
    padding: 22px 24px;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    animation: detailEnter 0.4s var(--spring-enter) both;
  }

  @keyframes detailEnter {
    from { opacity: 0; transform: translateY(10px) scale(0.98); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .detail-card::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.05) 0%, transparent 60%);
    pointer-events: none;
  }

  .detail-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 14px;
    margin-bottom: 18px;
    position: relative;
    z-index: 1;
  }

  .detail-title {
    font-size: var(--t-heading);
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--ink);
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    line-height: 1.25;
    flex: 1;
  }

  .detail-status-badge {
    font-size: var(--t-caption);
    font-weight: 600;
    padding: 4px 10px;
    border-radius: var(--radius-xs);
    letter-spacing: 0.03em;
    flex-shrink: 0;
  }

  .detail-status-badge.s-completed { background: rgba(80,175,120,0.15); color: var(--s-complete); }
  .detail-status-badge.s-running { background: rgba(82,138,220,0.15); color: var(--s-running); }
  .detail-status-badge.s-failed { background: rgba(200,80,80,0.15); color: var(--s-failed); }
  .detail-status-badge.s-queued { background: rgba(140,120,90,0.12); color: var(--s-queued); }

  .detail-meta-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 18px;
    position: relative;
    z-index: 1;
  }

  .detail-meta-item {
    background: rgba(255,255,255,0.03);
    border-top: 1px solid rgba(255,255,255,0.07);
    border-left: 1px solid rgba(255,255,255,0.05);
    border-right: 1px solid rgba(0,0,0,0.06);
    border-bottom: 1px solid rgba(0,0,0,0.08);
    border-radius: var(--radius-sm);
    padding: 10px 12px;
  }

  .detail-meta-label {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 4px;
  }

  .detail-meta-value {
    font-size: var(--t-sub);
    font-weight: 600;
    color: var(--ink);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  /* Progress bar for running ‚Äî NOT inline bottom bar, it's inside the detail pane */
  .detail-progress-section {
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
  }

  .detail-progress-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: var(--t-caption);
    color: var(--ink-muted);
  }

  .detail-progress-track {
    height: 4px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px;
    overflow: hidden;
  }

  .detail-progress-fill {
    height: 100%;
    background: var(--s-running);
    border-radius: 2px;
    transition: width 0.8s var(--spring-exit);
  }

  /* Action buttons */
  .detail-actions {
    display: flex;
    gap: 8px;
    position: relative;
    z-index: 1;
  }

  .detail-btn {
    padding: 9px 16px;
    border-radius: var(--radius-sm);
    font-size: var(--t-body);
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: transform 0.14s ease, box-shadow 0.14s ease;
  }
  .detail-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
  .detail-btn:active { transform: scale(0.97) translateY(0); box-shadow: var(--shadow-sm); }
  .detail-btn.primary { background: var(--accent); color: white; }
  .detail-btn.ghost {
    background: rgba(255,255,255,0.06);
    border-top: 1px solid var(--gb-top);
    border-left: 1px solid var(--gb-left);
    border-right: 1px solid var(--gb-right);
    border-bottom: 1px solid var(--gb-bottom);
    color: var(--ink-muted);
  }
  .detail-btn.danger { background: rgba(200,80,80,0.15); color: var(--s-failed); border: 1px solid rgba(200,80,80,0.2); }

  /* URL display */
  .detail-url {
    font-size: var(--t-caption);
    color: var(--ink-muted);
    word-break: break-all;
    padding: 10px 12px;
    background: rgba(0,0,0,0.2);
    border-radius: var(--radius-sm);
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
    line-height: 1.5;
  }

  /* ============================================================
     ACTIVITY ‚Äî bottom of reading pane
  ============================================================ */
  #activity-zone {
    border-top: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
    background: var(--glass-t3-bg);
    backdrop-filter: var(--glass-t3-blur);
    display: flex;
    flex-direction: column;
    height: 220px;
    position: relative;
  }

  #activity-zone::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 80% 5%, rgba(255,255,255,0.03) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .activity-hdr {
    padding: 10px 28px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
  }

  .activity-hdr-title {
    font-size: var(--t-caption);
    letter-spacing: 0.09em;
    text-transform: uppercase;
    color: var(--ink-muted);
    font-weight: 400;
  }

  .act-live-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--s-complete);
    flex-shrink: 0;
    animation: workerPulse 1.5s ease-in-out infinite;
  }

  #act-feed {
    flex: 1;
    overflow-y: auto;
    padding: 6px 28px;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.05) transparent;
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  #act-feed::-webkit-scrollbar { width: 2px; }
  #act-feed::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.05); }

  .act-entry {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    padding: 4px 0;
    animation: entryIn 0.28s var(--spring-enter) both;
  }

  @keyframes entryIn {
    from { opacity: 0; transform: translateX(6px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  .act-lvl {
    font-size: 9px;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: var(--radius-xs);
    flex-shrink: 0;
    margin-top: 1px;
  }
  .act-lvl.info { background: rgba(82,138,220,0.15); color: var(--s-running); }
  .act-lvl.ok { background: rgba(80,175,120,0.15); color: var(--s-complete); }
  .act-lvl.warn { background: rgba(200,160,60,0.12); color: hsl(42,52%,60%); }
  .act-lvl.error { background: rgba(200,80,80,0.15); color: var(--s-failed); }

  .act-text {
    font-size: var(--t-caption);
    color: var(--ink-faint);
    flex: 1;
    line-height: 1.4;
  }

  .act-ts {
    font-size: 0.625rem;
    color: var(--ink-muted);
    opacity: 0.65;
    flex-shrink: 0;
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
    white-space: nowrap;
  }

  /* Contacts view */
  #contacts-view {
    display: none;
    flex: 1;
    overflow-y: auto;
    padding: 16px 28px;
  }

  .contacts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
  }

  .contact-card {
    background: var(--glass-t2-bg);
    backdrop-filter: var(--glass-t2-blur);
    border-top: 1px solid var(--gb-top);
    border-left: 1px solid var(--gb-left);
    border-right: 1px solid var(--gb-right);
    border-bottom: 1px solid var(--gb-bottom);
    border-radius: var(--radius-md);
    padding: 16px;
    cursor: pointer;
    transition: box-shadow 0.2s ease, transform 0.14s ease;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    animation: cardIn 0.35s var(--spring-enter) both;
  }

  .contact-card::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    background: radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.04) 0%, transparent 60%);
    pointer-events: none;
  }

  @keyframes cardIn {
    from { opacity: 0; transform: translateY(8px) scale(0.97); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .contact-card:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }

  .contact-handle {
    font-size: var(--t-sub);
    font-weight: 600;
    letter-spacing: -0.01em;
    color: var(--ink);
    margin-bottom: 4px;
  }

  .contact-platform-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 10px;
  }

  .contact-p-badge {
    font-size: var(--t-caption);
    font-weight: 600;
    padding: 2px 7px;
    border-radius: var(--radius-xs);
  }
  .contact-p-badge.x { background: rgba(255,255,255,0.07); color: #b4c8e0; }
  .contact-p-badge.tiktok { background: rgba(255,90,120,0.1); color: #e0a8b8; }

  .contact-count {
    font-size: var(--t-body);
    font-weight: 700;
    color: var(--ink);
    font-variant-numeric: tabular-nums;
    font-feature-settings: "tnum";
  }

  .contact-count-label { font-size: var(--t-caption); color: var(--ink-muted); }

</style>
</head>
<body>

<div id="app">

  <!-- ============================================================
       LEFT NAV
  ============================================================ -->
  <nav id="nav" class="chrome-anim">
    <div class="nav-header">
      <div class="logo">
        <div class="logo-mark">‚¨°</div>
        Media Vault
      </div>
    </div>

    <div class="hero-section">
      <div class="hero-number" id="hero-complete">18</div>
      <div class="hero-label">Completed</div>
    </div>

    <div class="nav-section">
      <div class="nav-item active" id="nav-all" onclick="switchNav('all')">
        <span class="nav-icon">‚óâ</span>
        All Jobs
        <span class="nav-badge" id="nav-all-badge">7</span>
      </div>
      <div class="nav-item" id="nav-running" onclick="switchNav('running')">
        <span class="nav-icon">‚ñ∂</span>
        Running
        <span class="nav-badge running-badge" id="nav-running-badge">2</span>
      </div>
      <div class="nav-item" id="nav-contacts" onclick="switchNav('contacts')">
        <span class="nav-icon">‚óà</span>
        Contacts
        <span class="nav-badge">4</span>
      </div>
    </div>

    <div class="mini-stats">
      <div class="mini-stat">
        <div class="mini-stat-val" id="ms-done">18</div>
        <div class="mini-stat-lbl">Done</div>
      </div>
      <div class="mini-stat">
        <div class="mini-stat-val" id="ms-fail">3</div>
        <div class="mini-stat-lbl">Failed</div>
      </div>
    </div>

    <div class="nav-spacer"></div>

    <!-- SETTINGS -->
    <div class="nav-settings-section">
      <div class="settings-label">Platforms</div>
      <div class="platform-toggle-row" onclick="togglePlatform('x')">
        <div class="platform-toggle-name">
          <span class="platform-dot" style="background:#8ab0d0;"></span>
          X (Twitter)
        </div>
        <button class="toggle on" id="tog-x" aria-label="Toggle X"></button>
      </div>
      <div class="platform-toggle-row" onclick="togglePlatform('tiktok')">
        <div class="platform-toggle-name">
          <span class="platform-dot" style="background:#d090a8;"></span>
          TikTok
        </div>
        <button class="toggle on" id="tog-tt" aria-label="Toggle TikTok"></button>
      </div>
    </div>

    <div class="worker-status">
      <div class="worker-dot active" id="worker-dot"></div>
      <span id="worker-text">Worker active</span>
    </div>
  </nav>

  <!-- ============================================================
       JOB LIST COLUMN
  ============================================================ -->
  <div id="job-list-col" class="list-anim">
    <div class="list-col-header">
      <div class="list-col-title" id="list-col-title">All Jobs</div>
      <div class="density-tag">
        <div class="density-dot"></div>
        <span id="density-label">Standard</span>
      </div>
    </div>
    <div id="job-list-scroll" class="density-standard">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- ============================================================
       READING PANE
  ============================================================ -->
  <div id="reading-pane" class="pane-anim">
    <div id="pane-upper">

      <!-- INTAKE HERO -->
      <div id="intake-zone" class="intake-anim">
        <div class="intake-eyebrow">New Download</div>
        <div class="intake-form-row" id="intake-wrap">
          <div class="intake-shell" id="intake-shell">
            <span class="intake-icon-prefix">‚Üì</span>
            <input type="url" id="url-input"
              placeholder="Paste a URL from X or TikTok‚Ä¶"
              autocomplete="off" spellcheck="false">
            <span class="p-chip x-chip" id="chip-x">ùïè X</span>
            <span class="p-chip tt-chip" id="chip-tt">‚ô™ TikTok</span>
          </div>
          <button class="intake-submit" id="submit-btn" onclick="doSubmit()">Download</button>
        </div>
      </div>

      <!-- JOB DETAIL -->
      <div id="detail-zone">
        <div class="detail-empty" id="detail-empty">
          <div class="detail-empty-icon">‚óé</div>
          <div class="detail-empty-text">Select a job to view details</div>
        </div>
        <div id="detail-content" style="display:none;"></div>
      </div>

      <!-- CONTACTS VIEW (hidden initially) -->
      <div id="contacts-view">
        <div class="contacts-grid" id="contacts-grid"></div>
      </div>

    </div>

    <!-- ACTIVITY -->
    <div id="activity-zone">
      <div class="activity-hdr">
        <div class="act-live-dot"></div>
        <div class="activity-hdr-title">Activity Stream</div>
      </div>
      <div id="act-feed"></div>
    </div>
  </div>

</div>

<script>
  // ============================================================
  // DATA
  // ============================================================
  const CONTACTS_DATA = [
    { slug: 'kaito_yamamoto', handle: '@kaito_yamamoto', platform: 'x' },
    { slug: 'aria_voss', handle: '@aria_voss', platform: 'tiktok' },
    { slug: 'devlin_marsh', handle: '@devlin_marsh', platform: 'x' },
    { slug: 'priya_chen', handle: '@priya_chen', platform: 'tiktok' },
  ];

  let jobs = [
    { id:'j1', creator:'kaito_yamamoto', platform:'x', title:'Thread on procedural generation', status:'completed', size:'142 MB', duration:'4:22', ts:'2m', url:'https://x.com/kaito_yamamoto/status/1234567' },
    { id:'j2', creator:'kaito_yamamoto', platform:'x', title:'Live coding session highlights', status:'completed', size:'89 MB', duration:'2:10', ts:'18m', url:'https://x.com/kaito_yamamoto/status/1234568' },
    { id:'j3', creator:'aria_voss', platform:'tiktok', title:'Morning routine ambient edit', status:'running', size:'‚Äî', duration:'1:30', ts:'now', url:'https://tiktok.com/@aria_voss/video/1234', progress:34 },
    { id:'j4', creator:'aria_voss', platform:'tiktok', title:'Recipe: soft-scrambled eggs', status:'queued', size:'‚Äî', duration:'0:58', ts:'1m', url:'https://tiktok.com/@aria_voss/video/1235', progress:0 },
    { id:'j5', creator:'devlin_marsh', platform:'x', title:'Kernel debugging walkthrough', status:'failed', size:'‚Äî', duration:'8:45', ts:'5m', url:'https://x.com/devlin_marsh/status/1234569', error:'Extraction timeout after 30s' },
    { id:'j6', creator:'devlin_marsh', platform:'x', title:'SSH tunneling explainer', status:'completed', size:'320 MB', duration:'12:03', ts:'1h', url:'https://x.com/devlin_marsh/status/1234570' },
    { id:'j7', creator:'priya_chen', platform:'tiktok', title:'Botanical watercolor timelapse', status:'running', size:'‚Äî', duration:'3:15', ts:'now', url:'https://tiktok.com/@priya_chen/video/1236', progress:61 },
  ];

  let selectedId = null;
  let currentNav = 'all';
  let pulsedJobId = null;
  let platformState = { x: true, tiktok: true };

  // ============================================================
  // ADAPTIVE DENSITY ‚Äî THE SPECIAL FEATURE
  // ============================================================
  function getDensityTier(count) {
    if (count <= 4) return 'spacious';
    if (count <= 9) return 'standard';
    return 'compact';
  }

  function applyDensity(visibleJobs) {
    const tier = getDensityTier(visibleJobs.length);
    const scroll = document.getElementById('job-list-scroll');
    scroll.className = 'density-' + tier;
    const labels = { spacious: 'Spacious', standard: 'Standard', compact: 'Compact' };
    document.getElementById('density-label').textContent = labels[tier];
  }

  // ============================================================
  // RENDER
  // ============================================================
  function getVisibleJobs() {
    if (currentNav === 'running') return jobs.filter(j => j.status === 'running');
    return jobs;
  }

  function renderJobList() {
    const visibleJobs = getVisibleJobs();
    const scroll = document.getElementById('job-list-scroll');

    // Determine which running job gets the pulse (first one only)
    pulsedJobId = null;
    jobs.forEach(j => { if (j.status === 'running' && !pulsedJobId) pulsedJobId = j.id; });

    applyDensity(visibleJobs);

    let html = '';
    visibleJobs.forEach((job, i) => {
      const isSelected = job.id === selectedId;
      const isPulsed = job.id === pulsedJobId;
      const delay = Math.max(0, 120 - i * 20);

      html += `
        <div class="job-row job-row-enter ${isSelected ? 'selected' : ''}"
          id="row-${job.id}"
          style="animation-delay:${delay}ms"
          onclick="selectJob('${job.id}')">
          <div class="row-status-icon s-${job.status}${isPulsed ? ' single-pulse' : ''}">${statusGlyph(job.status)}</div>
          <div class="row-body">
            <div class="row-creator">${job.creator.replace(/_/g,' ')}</div>
            <div class="row-title">${job.title}</div>
            <div class="row-meta">
              <span class="job-p-lbl" style="font-size:var(--t-caption);font-weight:600;padding:1px 5px;border-radius:var(--radius-xs);background:rgba(255,255,255,0.05);color:var(--ink-muted)">${job.platform === 'x' ? 'ùïè' : '‚ô™'}</span>
              ${job.size !== '‚Äî' ? `<span class="numeric"> ¬∑ ${job.size}</span>` : ''}
              ${job.duration ? `<span class="numeric"> ¬∑ ${job.duration}</span>` : ''}
              ${job.status === 'running' ? `<span class="numeric" style="color:var(--s-running)"> ¬∑ ${Math.round(job.progress||0)}%</span>` : ''}
            </div>
          </div>
          <div class="row-time timestamp">${job.ts}</div>
        </div>`;
    });

    scroll.innerHTML = html;
    updateBadges();
  }

  function statusGlyph(s) {
    return { completed:'‚úì', running:'‚ñ∂', failed:'‚úï', queued:'‚óã', canceled:'‚óá' }[s] || '?';
  }

  function updateBadges() {
    const running = jobs.filter(j => j.status === 'running').length;
    const done = jobs.filter(j => j.status === 'completed').length;
    const failed = jobs.filter(j => j.status === 'failed').length;

    document.getElementById('nav-all-badge').textContent = jobs.length;
    document.getElementById('nav-running-badge').textContent = running;
    document.getElementById('hero-complete').textContent = done + 18;
    document.getElementById('ms-done').textContent = done + 18;
    document.getElementById('ms-fail').textContent = failed;

    // Worker dot
    const hasRunning = running > 0;
    const dot = document.getElementById('worker-dot');
    dot.classList.toggle('active', hasRunning);
    document.getElementById('worker-text').textContent = hasRunning ? 'Worker active' : 'Worker idle';
  }

  // ============================================================
  // SELECT JOB ‚Äî READING PANE
  // ============================================================
  function selectJob(id) {
    selectedId = id;
    renderJobList();
    renderDetail();
  }

  function renderDetail() {
    const job = jobs.find(j => j.id === selectedId);
    const emptyEl = document.getElementById('detail-empty');
    const contentEl = document.getElementById('detail-content');

    if (!job) {
      emptyEl.style.display = 'flex';
      contentEl.style.display = 'none';
      return;
    }

    emptyEl.style.display = 'none';
    contentEl.style.display = 'block';

    let progressHtml = '';
    if (job.status === 'running') {
      progressHtml = `
        <div class="detail-progress-section">
          <div class="detail-progress-row">
            <span>Downloading‚Ä¶</span>
            <span class="numeric" id="detail-pct">${Math.round(job.progress||0)}%</span>
          </div>
          <div class="detail-progress-track">
            <div class="detail-progress-fill" id="detail-fill" style="width:${job.progress||0}%"></div>
          </div>
        </div>`;
    }

    let actionsHtml = '';
    if (job.status === 'failed') {
      actionsHtml = `
        <button class="detail-btn primary" onclick="retryJob('${job.id}')">‚Ü∫ Retry</button>
        <button class="detail-btn danger" onclick="deleteJob('${job.id}')">Delete</button>`;
    } else if (job.status === 'completed') {
      actionsHtml = `
        <button class="detail-btn primary">‚Üì Open File</button>
        <button class="detail-btn ghost" onclick="deleteJob('${job.id}')">Delete</button>`;
    } else {
      actionsHtml = `<button class="detail-btn ghost" onclick="deleteJob('${job.id}')">Cancel</button>`;
    }

    contentEl.innerHTML = `
      <div class="detail-card" id="detail-card-${job.id}">
        <div class="detail-header">
          <div class="detail-title">${job.title}</div>
          <div class="detail-status-badge s-${job.status}">${job.status.toUpperCase()}</div>
        </div>
        <div class="detail-url">${job.url}</div>
        <div class="detail-meta-grid">
          <div class="detail-meta-item">
            <div class="detail-meta-label">Creator</div>
            <div class="detail-meta-value">${job.creator.replace(/_/g,' ')}</div>
          </div>
          <div class="detail-meta-item">
            <div class="detail-meta-label">Platform</div>
            <div class="detail-meta-value">${job.platform === 'x' ? 'ùïè X' : '‚ô™ TikTok'}</div>
          </div>
          <div class="detail-meta-item">
            <div class="detail-meta-label">Duration</div>
            <div class="detail-meta-value numeric">${job.duration || '‚Äî'}</div>
          </div>
          <div class="detail-meta-item">
            <div class="detail-meta-label">File Size</div>
            <div class="detail-meta-value numeric">${job.size}</div>
          </div>
          <div class="detail-meta-item">
            <div class="detail-meta-label">Added</div>
            <div class="detail-meta-value timestamp">${job.ts} ago</div>
          </div>
          <div class="detail-meta-item">
            <div class="detail-meta-label">Job ID</div>
            <div class="detail-meta-value" style="font-size:var(--t-caption);opacity:0.7">${job.id}</div>
          </div>
        </div>
        ${progressHtml}
        ${job.error ? `<div style="background:rgba(200,80,80,0.08);border:1px solid rgba(200,80,80,0.15);border-radius:var(--radius-sm);padding:10px 12px;margin-bottom:14px;font-size:var(--t-body);color:var(--s-failed);">‚ö† ${job.error}</div>` : ''}
        <div class="detail-actions">${actionsHtml}</div>
      </div>`;
  }

  // ============================================================
  // CONTACTS VIEW
  // ============================================================
  function renderContacts() {
    const grid = document.getElementById('contacts-grid');
    let html = '';
    CONTACTS_DATA.forEach((c, i) => {
      const cJobs = jobs.filter(j => j.creator === c.slug);
      const delay = Math.max(0, 120 - i * 20);
      html += `
        <div class="contact-card" style="animation-delay:${delay}ms">
          <div class="contact-handle">${c.handle}</div>
          <div class="contact-platform-row">
            <span class="contact-p-badge ${c.platform}">${c.platform === 'x' ? 'ùïè X' : '‚ô™ TikTok'}</span>
          </div>
          <div class="contact-count numeric">${cJobs.length}</div>
          <div class="contact-count-label">${cJobs.length === 1 ? 'download' : 'downloads'}</div>
        </div>`;
    });
    grid.innerHTML = html;
  }

  // ============================================================
  // NAV SWITCHING
  // ============================================================
  function switchNav(name) {
    currentNav = name;
    ['all','running','contacts'].forEach(n => {
      document.getElementById('nav-' + n).classList.toggle('active', n === name);
    });

    const isCont = name === 'contacts';
    document.getElementById('job-list-col').style.display = isCont ? 'none' : '';
    document.getElementById('contacts-view').style.display = isCont ? 'block' : 'none';
    document.getElementById('detail-zone').style.display = isCont ? 'none' : 'block';

    if (isCont) {
      renderContacts();
    } else {
      const titles = { all: 'All Jobs', running: 'Running' };
      document.getElementById('list-col-title').textContent = titles[name] || 'Jobs';
      renderJobList();
    }
  }

  // ============================================================
  // INTAKE
  // ============================================================
  const urlInput = document.getElementById('url-input');
  const chipX = document.getElementById('chip-x');
  const chipTt = document.getElementById('chip-tt');
  const intakeShell = document.getElementById('intake-shell');
  const intakeWrap = document.getElementById('intake-wrap');

  urlInput.addEventListener('input', () => {
    const v = urlInput.value;
    chipX.classList.toggle('show', /twitter\.com|x\.com/i.test(v));
    chipTt.classList.toggle('show', /tiktok\.com/i.test(v));
  });

  // Magnetic hover
  intakeWrap.addEventListener('mousemove', e => {
    const r = intakeWrap.getBoundingClientRect();
    const dx = (e.clientX - (r.left + r.width/2)) / r.width * 3;
    const dy = (e.clientY - (r.top + r.height/2)) / r.height * 2;
    intakeShell.style.transform = `translate(${dx.toFixed(2)}px,${dy.toFixed(2)}px)`;
  });
  intakeWrap.addEventListener('mouseleave', () => { intakeShell.style.transform = ''; });

  function doSubmit() {
    const v = urlInput.value.trim();
    if (!v) {
      intakeShell.style.outline = '2px solid var(--s-failed)';
      setTimeout(() => intakeShell.style.outline = '', 1200);
      return;
    }
    const isTt = /tiktok\.com/i.test(v);
    const platform = isTt ? 'tiktok' : 'x';
    const creator = isTt ? 'aria_voss' : 'kaito_yamamoto';

    const btn = document.getElementById('submit-btn');
    btn.textContent = '‚úì Added';
    btn.classList.add('ok');

    const newJob = {
      id: 'j' + Date.now(),
      creator, platform,
      title: v.length > 55 ? v.substring(0,55) + '‚Ä¶' : v,
      status: 'queued',
      size: '‚Äî', duration: '‚Äî', ts: 'now',
      url: v, progress: 0
    };
    jobs.unshift(newJob);
    addActivity('info', `Job queued: ${newJob.title.substring(0,40)}`);
    renderJobList();

    setTimeout(() => {
      btn.textContent = 'Download';
      btn.classList.remove('ok');
      urlInput.value = '';
      chipX.classList.remove('show');
      chipTt.classList.remove('show');
    }, 900);
  }

  // ============================================================
  // PLATFORM TOGGLE
  // ============================================================
  function togglePlatform(p) {
    platformState[p] = !platformState[p];
    document.getElementById('tog-' + (p === 'x' ? 'x' : 'tt')).classList.toggle('on', platformState[p]);
    addActivity(platformState[p] ? 'ok' : 'warn', `${p.toUpperCase()} ${platformState[p] ? 'enabled' : 'disabled'}`);
  }

  // ============================================================
  // JOB ACTIONS
  // ============================================================
  function deleteJob(id) {
    jobs = jobs.filter(j => j.id !== id);
    if (selectedId === id) { selectedId = null; renderDetail(); }
    addActivity('warn', 'Job deleted');
    renderJobList();
  }

  function retryJob(id) {
    const j = jobs.find(j => j.id === id);
    if (j) {
      j.status = 'queued'; j.error = null; j.ts = 'now';
      addActivity('info', `Retrying: ${j.title.substring(0,35)}`);
      renderJobList();
      if (selectedId === id) renderDetail();
    }
  }

  // ============================================================
  // ACTIVITY FEED
  // ============================================================
  const ACT_MSGS = [
    ['info','Playwright navigating to post URL'],
    ['info','Network interception active on page'],
    ['info','HLS manifest URL captured'],
    ['ok','Extraction complete ‚Äî 2 candidates'],
    ['info','Selecting 1080p H.264 stream'],
    ['info','ffmpeg: HLS download started'],
    ['info','Download progress: 52%'],
    ['ok','Job completed ‚Äî file saved to disk'],
    ['info','Worker polling ‚Äî queue check'],
    ['warn','X.com rate limit ‚Äî backing off 2s'],
    ['info','TikTok MP4 direct link extracted'],
    ['ok','Direct fetch complete ‚Äî 89 MB'],
    ['error','Page load timeout ‚Äî retrying'],
    ['info','Playwright: new page created'],
    ['warn','Cloudflare challenge ‚Äî waiting'],
  ];
  let actIdx = 0;

  function addActivity(level, text) {
    const feed = document.getElementById('act-feed');
    const ts = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const lvlMap = {info:'I',ok:'‚úì',warn:'W',error:'E'};
    const el = document.createElement('div');
    el.className = 'act-entry';
    el.innerHTML = `
      <span class="act-lvl ${level}">${lvlMap[level]||'I'}</span>
      <span class="act-text">${text}</span>
      <span class="act-ts">${ts}</span>`;
    feed.insertBefore(el, feed.firstChild);
    while (feed.children.length > 50) feed.removeChild(feed.lastChild);
  }

  setInterval(() => {
    const [l, t] = ACT_MSGS[actIdx % ACT_MSGS.length];
    addActivity(l, t);
    actIdx++;
  }, 2500);

  // ============================================================
  // JOB SIMULATION
  // ============================================================
  function advanceSim() {
    let changed = false;
    jobs.forEach(job => {
      if (job.status === 'running') {
        job.progress = Math.min(100, (job.progress || 0) + Math.random() * 7 + 2);
        if (job.progress >= 100) {
          job.status = 'completed';
          job.size = (Math.random() * 300 + 40).toFixed(0) + ' MB';
          job.ts = 'now';
          addActivity('ok', `Completed: ${job.title.substring(0,35)}`);
          changed = true;
        } else {
          // Update detail if this is selected
          if (selectedId === job.id) {
            const fill = document.getElementById('detail-fill');
            const pct = document.getElementById('detail-pct');
            if (fill) fill.style.width = job.progress + '%';
            if (pct) pct.textContent = Math.round(job.progress) + '%';
          }
        }
      } else if (job.status === 'queued' && Math.random() < 0.07) {
        job.status = 'running'; job.progress = 0; job.ts = 'now';
        addActivity('info', `Started: ${job.title.substring(0,35)}`);
        changed = true;
      }
    });
    if (changed) {
      renderJobList();
      if (selectedId) renderDetail();
    }
  }

  setInterval(advanceSim, 1100);

  // ============================================================
  // INIT
  // ============================================================
  window.addEventListener('load', () => {
    renderJobList();

    [
      ['info','Media Vault initialized'],
      ['info','MongoDB connection established'],
      ['info','Playwright context ready'],
      ['ok','Queue worker started'],
    ].forEach(([l,t],i) => setTimeout(() => addActivity(l,t), i*220));

    setTimeout(() => document.getElementById('app').classList.add('ready'), 60);
  });
</script>
</body>
</html>
